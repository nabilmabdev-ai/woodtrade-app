
const fs = require('fs');
const path = require('path');
const { backendPermissionsMap } = require('../src/lib/permissions-map');

const FRONTEND_PERMISSIONS_PATH = path.join(process.cwd(), 'src/lib/permissions.ts');

function syncFrontendPermissions() {
  const content = `
import { Role } from '@prisma/client';

// This file is auto-generated by scripts/sync-frontend-permissions.js. Do not edit manually.

export const backendPermissionsMap = ${JSON.stringify(backendPermissionsMap, null, 2)};

export const canViewUsers = (role: Role) => backendPermissionsMap['/users']['GET'].includes(role);
export const canViewBilling = (role: Role) => backendPermissionsMap['/billing/invoices']['GET'].includes(role);
export const canViewWarehouse = (role: Role) => backendPermissionsMap['/inventory']['GET'].includes(role);
export const canViewCashRegisters = (role: Role) => backendPermissionsMap['/cash-registers']['GET'].includes(role);
export const canCreateInvoices = (role: Role) => backendPermissionsMap['/billing/invoices']['POST'].includes(role);
export const canManagePayments = (role: Role) => backendPermissionsMap['/billing/payments']['GET'].includes(role);
export const canManageCreditNotes = (role: Role) => backendPermissionsMap['/billing/credit-notes']['GET'].includes(role);
export const canViewReconciliation = (role: Role) => backendPermissionsMap['/billing/reconciliation']['POST'].includes(role);
export const canAddCashRegister = (role: Role) => backendPermissionsMap['/cash-registers']['POST'].includes(role);
export const canManageCashRegisterSession = (role: Role) => backendPermissionsMap['/cash-registers/[id]/close-session']['POST'].includes(role);
export const canCreateCashRegisterMovement = (role: Role) => backendPermissionsMap['/cash-registers/[id]/movements']['POST'].includes(role);
export const canManageWarehouse = (role: Role) => backendPermissionsMap['/inventory/adjust']['POST'].includes(role);
`;

  fs.writeFileSync(FRONTEND_PERMISSIONS_PATH, content);
  console.log('âœ… Frontend permissions synced.');
}

syncFrontendPermissions();
